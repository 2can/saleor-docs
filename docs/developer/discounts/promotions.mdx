---
title: Promotions
sidebar_label: Promotions
---

## Introduction

Promotions allow price reduction based on defined conditions.
The promotion conditions are defined in the promotion rules as predicates.
One promotion can have multiple rules, but the rule can be part of only one promotion.
Promotion rules define the conditions to be met, as well as the discount reward.

The discounts from rules with catalogue predicates are automatically applied to all products
that met the conditions defined in the promotion.

For instance, if a product is priced at **$9** and has a **10%** discount, it will be available for **$8.1**.
The discount will be visible on `ProductVariant.pricing` - `priceUndiscounted` will be the price
before the promotion discount, and `price` will have an applied discount.
The promotion discount will be also visible on the checkout line prices after adding the discounted
product to the card. The checkout subtotal is calculated as a sum of discounted prices of variants
added to the cart.

When multiple promotions apply to one product, the promotion with the greatest savings is used.
The discounts from rules within the single promotion are summed up.

:::note
The catalogue discounts from promotions are calculated in the background. So the discounted
price will be not visible just after promotion creation.
:::

### Examples of the use cases

### Permissions

Managing webhooks is available for users with the MANAGE_APPS permission. The App can also create and modify its own webhooks without the need for additional permissions.

### Glossary

- **Promotion**: Consists of promotion rules, and defines the start and end date when the discounts
  from the rules will be applied.
- **Promotion rule**: Defines the reward that will be given when the specified conditions are met.
- **Catalogue predicate**: Defines the conditions to be met on catalogue level.
  When the conditions are met, the discount is applied automatically to corresponding variant prices.
- **Reward**: Describe what kind of reward is given when the promotion rule condition are met.
  Currently only discount reward is available (percentage or fixed).

## Predicates

Predicates define the conditions to be met to apply the reward.
Allows defining complex nested conditions in the same way as in `where` filters, with `AND` and `OR` operators,
combined with operations (e.g. `eq`, `oneOf`).
To get to know how to build complex conditions reach out to the [filters page](../filtering#general-approach).

Currently only predicates on catalogue levels are available,
that allow to define the conditions for variants, products, collections and categories.

#### Catalogue predicates examples

## Rewards

Rewards are defined on the promotion rule level, and specify the discount type and value
that will be applied when the defined conditions are met.
Currently, there is only `FIXED` or `PRECENTAGE` discount available.

## Channel availability

Each rule can have assigned channels in which the discount will be applied.
Promotion rules without any channels will not apply anywhere.

The promotion rule can have multiple channels assigned, but there is a restriction to that.
When the rule reward value type is `FIXED`, all assigned channels must have the same currency.

## Creating the promotion

To create a promotion use `promotionCreate` mutation.

The mutation takes the following input:

- `name`: name of the promotion;
- `description`: optional description of the promotion;
- `startDate`: defines when the promotion becomes active;
- `endDate`: defines when the promotion becomes ends;
- `rules`: optional list of promotion rules. The rules could be also created
  by `promotionRuleCreate` mutation.

### Defining the promotion

Below is an example of promotion creation without any rules.

```graphql
mutation promotionCreate($input: PromotionCreateInput!) {
  promotionCreate(input: $input) {
    promotion {
      id
      name
      description
      startDate
      endDate
    }
  }
}
```

Query variables:

```json
{
  "input": {
    "name": "Example sale",
    "description": {
      "blocks": [
        {
          "type": "paragraph",
          "data": {
            "text": "Test example sale."
          }
        }
      ]
    },
    "startDate": "2023-06-06T00:00:00.00+00:00"
  }
}
```

As a response, we will get a newly created promotion:

```json
{
  "data": {
    "promotionCreate": {
      "promotion": {
        "id": "UHJvbW90aW9uOjEyMzA0YmM4LTA2ZTMtNDg1Mi05ODU1LWM4ZDkyMDgzNTYwZA==",
        "name": "Example sale",
        "description": {
          "blocks": [
            {
              "type": "paragraph",
              "data": {
                "text": "Test example sale."
              }
            }
          ]
        },
        "startDate": "2023-06-06T00:00:00+00:00",
        "endDate": null
      }
    }
  }
}
```

### Add promotion rule

To add a promotion rule to the promotion use `promotionRuleCreate` mutation.

The mutation takes the following input:

- `name`: optional name of the promotion rule;
- `description`: optional description of the promotion rule;
- `promotion`: define to which promotion the rule should be part of;
- `channels`: define in which channels the rule should be applicable;
- `rewardValueType`: define the type of discount `PERCENTAGE`/`FIXED`;
- `rewardValue`: define the value of the discount;
- `cataloguePredicate`: defines the conditions to be met. Allows defining complex nested
  conditions with `AND` and `OR` operators.

The following example demonstrates the creation of a promotion rule that applies
a 50% discount on all products from a collection and categories with specified IDs.
The rule will be applicable on two channels

```graphql
mutation promotionRuleCreate($input: PromotionRuleCreateInput!) {
  promotionRuleCreate(input: $input) {
    promotionRule {
      id
      name
      description
      promotion {
        id
      }
      channels {
        id
      }
      rewardValueType
      rewardValue
      cataloguePredicate
    }
  }
}
```

To define such a discount the catalogue predicate with `OR` operator is used, to
mark that any products from given collections or categories are included in this promotion.

Query variables:

```json
{
  "input": {
    "name": "50% percentage discount",
    "promotion": "UHJvbW90aW9uOjEyMzA0YmM4LTA2ZTMtNDg1Mi05ODU1LWM4ZDkyMDgzNTYwZA==",
    "channels": ["Q2hhbm5lbDoy", "Q2hhbm5lbDo0"],
    "rewardValueType": "PERCENTAGE",
    "rewardValue": "50",
    "cataloguePredicate": {
      "OR": [
        {
          "categoryPredicate": {
            "ids": ["Q2F0ZWdvcnk6MQ==", "Q2F0ZWdvcnk6NDQ="]
          }
        },
        {
          "collectionPredicate": {
            "ids": ["Q29sbGVjdGlvbjo1"]
          }
        }
      ]
    }
  }
}
```

As a result, we get a newly created promotion:

```json
{
  "data": {
    "promotionRuleCreate": {
      "promotionRule": {
        "id": "UHJvbW90aW9uUnVsZTo0NThmMTFlZC04NTIxLTQ0YTgtYmM2YS1iNjNmNzg0Yzc0ZmM=",
        "name": "50% percentage discount",
        "description": null,
        "promotion": {
          "id": "UHJvbW90aW9uOjEyMzA0YmM4LTA2ZTMtNDg1Mi05ODU1LWM4ZDkyMDgzNTYwZA=="
        },
        "channels": [
          {
            "id": "Q2hhbm5lbDoy"
          },
          {
            "id": "Q2hhbm5lbDo0"
          }
        ],
        "rewardValueType": "PERCENTAGE",
        "rewardValue": 50,
        "cataloguePredicate": {
          "OR": [
            {
              "categoryPredicate": {
                "ids": ["Q2F0ZWdvcnk6MQ==", "Q2F0ZWdvcnk6NDQ="]
              }
            },
            {
              "collectionPredicate": {
                "ids": ["Q29sbGVjdGlvbjo1"]
              }
            }
          ]
        }
      }
    }
  }
}
```

---

## Discounted price recalculations

The discounts for specified catalogues are calculated asynchronously, so the discounted price
will be not visible immediately after promotion creation or activation.

The discounted price is visible on `ProductVariant.pricing`.
Below you can see the pricing of the variant included in the newly created promotion:

```json
{
  "data": {
    "productVariant": {
      "id": "UHJvZHVjdFZhcmlhbnQ6MzM1",
      "pricing": {
        "onSale": true,
        "priceUndiscounted": {
          "gross": {
            "amount": 90.0
          }
        },
        "price": {
          "gross": {
            "amount": 45.0
          }
        },
        "discount": {
          "gross": {
            "amount": 45.0
          }
        }
      }
    }
  },
  "extensions": {
    "cost": {
      "requestedQueryCost": 2,
      "maximumAvailable": 50000
    }
  }
}
```

As you can see, the variant is `onSale` and the price was reduced by half.

## Promotion events history

We store the promotion history in events. Each action related to the creation, update,
or deletion of promotions and promotion rules, and activation and deactivation of promotion
is recorded in an event. You can check the list of all possible events [here] (TODO: link to PromotionEventsEnum).

You can check promotion events by fetching `promotion.events`. As it's shown
in the example below:

```graphql
query Promotion($id: ID!) {
  promotion(id: $id) {
    id
    events {
      ... on PromotionEventInterface {
        type
        date
        createdBy {
          ... on User {
            id
          }
        }
      }
      ... on PromotionRuleEventInterface {
        ruleId
      }
    }
  }
}
```

Query variable:

```json
{
  "id": "UHJvbW90aW9uOmYxMWQ5ZWRiLTI5ZjktNDA5Yy05MjdlLTNjOGMzMDFjZjM2NA=="
}
```

Response:

```json
{
  "data": {
    "promotion": {
      "id": "UHJvbW90aW9uOjEyMzA0YmM4LTA2ZTMtNDg1Mi05ODU1LWM4ZDkyMDgzNTYwZA==",
      "events": [
        {
          "type": "PROMOTION_CREATED",
          "date": "2023-09-21T12:28:16.457902+00:00",
          "createdBy": {
            "id": "VXNlcjox"
          }
        },
        {
          "type": "PROMOTION_STARTED",
          "date": "2023-09-21T12:28:16.464749+00:00",
          "createdBy": {
            "id": "VXNlcjox"
          }
        },
        {
          "type": "RULE_CREATED",
          "date": "2023-09-21T12:30:17.520316+00:00",
          "createdBy": {
            "id": "VXNlcjox"
          },
          "ruleId": "UHJvbW90aW9uUnVsZTo1MjIwYmViZS02MjczLTRkNjUtYTNkZC1iYjNlYmI4MjllYjA="
        }
      ]
    }
  }
}
```

## Webhooks

All promotion actions also generate asynchronous webhooks that can be used for reacting
to the events emitted by Saleor, e.g. `PROMOTION_CREATED`, `PROMOTION_STARTED`, `PROMOTION_ENDED`.
The [WebhookEventTypeAsyncEnum](/api-reference/webhooks/enums/webhook-event-type-async-enum.mdx#values)
represents the full list of asynchronous webhooks.

You can learn more about webhooks [here](developer/extending/webhooks/asynchronous-events.mdx).

:::info
The promotion discount is not visible on `checkout.discount.amount`.
:::

In the example below, we add an on-sale product to the checkout.
The response of the `checkoutLinesAdd` mutation will include the discounted product price.

To calculate the total applied discount, subtract the `line.undiscountedTotalPrice` from the `line.totalPrice`.
To calculate the discount on one unit, subtract the `line.undiscountedUnitPrice` from the `line.unitPrice`.
